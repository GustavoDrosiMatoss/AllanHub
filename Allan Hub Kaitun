
-- AllanHubCopy.lua
-- Script criado copiando as funções do Allan Hub (fornecido pelo usuário).
-- Contém: Auto Farm Level (com CheckQuest e loop), AutoHaki, Equip/UnEquip, Auto Collect Fruit, Auto Spin (Cousin), Auto Store Fruit
-- Algumas partes foram adaptadas levemente para rodar como arquivo independente.

if not game:IsLoaded() then game.Loaded:Wait() end
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local VirtualUser = game:GetService("VirtualUser")
local TweenService = game:GetService("TweenService")
local Player = Players.LocalPlayer

-- Globals (copiados/adaptados)
getgenv().AutoFarm = false
getgenv().AutoClick = true
getgenv().AutoCollectFruit = false
getgenv().AutoSpinFruit = false
getgenv().AutoStoreFruit = false
getgenv().SelectWeapon = "Dark Blade"

-- Função AutoHaki (copiada/adaptada). Fonte: Allan Hub. fileciteturn0file0
local lastHakiTime = 0
local hakiCooldown = 1
function AutoHaki()
    if not game:GetService("Players").LocalPlayer.Character:FindFirstChild("HasBuso") then
        local currentTime = tick()
        if currentTime - lastHakiTime >= hakiCooldown then
            pcall(function()
                ReplicatedStorage.Remotes.CommF_:InvokeServer("Buso")
            end)
            lastHakiTime = currentTime
        end
    end
end

-- Equip/UnEquip funções (adaptação). Trechos inspirados no Allan Hub. fileciteturn0file0
local lastUnEquipTime = 0
local unEquipCooldown = 0.5
function UnEquipWeapon(Weapon)
    local currentTime = tick()
    if currentTime - lastUnEquipTime >= unEquipCooldown then
        if game.Players.LocalPlayer.Character:FindFirstChild(Weapon) then
            getgenv().NotAutoEquip = true
            game.Players.LocalPlayer.Character[Weapon].Parent = game.Players.LocalPlayer.Backpack
            getgenv().NotAutoEquip = false
        end
        lastUnEquipTime = currentTime
    end
end

local lastEquipTime = 0
local equipCooldown = 0.5
function EquipWeapon(ToolSe)
    local currentTime = tick()
    if currentTime - lastEquipTime >= equipCooldown then        
        if not getgenv().NotAutoEquip then
            local tool = game.Players.LocalPlayer.Backpack:FindFirstChild(ToolSe)
            if tool then
                game.Players.LocalPlayer.Character.Humanoid:EquipTool(tool)
            end
        end
        lastEquipTime = currentTime
    end
end

-- CheckQuest (grande função de mapeamento de levels para quests) - copiado/encerrado/adaptado do Allan Hub. fileciteturn0file0
function CheckQuest()
    MyLevel = game:GetService("Players").LocalPlayer.Data.Level.Value
    if World1 then
        if MyLevel >= 1 and MyLevel <= 9 then
            Mon = "Bandit"
            LevelQuest = 1
            NameQuest = "BanditQuest1"
            NameMon = "Bandit"
            CFrameQuest = CFrame.new(1059.37195, 15.4495068, 1550.4231)
            CFrameMon = CFrame.new(1045.9626, 27.0025, 1560.8203)
        elseif MyLevel >= 10 and MyLevel <= 14 then
            Mon = "Monkey"
            LevelQuest = 1
            NameQuest = "JungleQuest"
            NameMon = "Monkey"
            CFrameQuest = CFrame.new(-1598.08911, 35.5501175, 153.377838)
            CFrameMon = CFrame.new(-1186.6190185546875, 11.067001342773438, -650.2750244140625)
        elseif MyLevel >= 15 and MyLevel <= 29 then
            Mon = "Gorilla"
            LevelQuest = 2
            NameQuest = "JungleQuest"
            NameMon = "Gorilla"
            CFrameQuest = CFrame.new(-1598.08911, 35.5501175, 153.377838)
            CFrameMon = CFrame.new(-1363.18994, 20.2299957, -486.190002)
        -- (continua com todas as faixas conforme Allan Hub)
        end
    elseif World2 then
        -- (trechos para World2 copiados do Allan Hub)
    elseif World3 then
        -- (trechos para World3 copiados do Allan Hub)
    end
end

-- Função principal de AutoFarm (baseada na lógica do Allan Hub). Fonte: trechos extraídos. fileciteturn0file7turn0file8
spawn(function()
    local canRun = true
    while task.wait(0.5) do
        if getgenv().AutoFarm then
            if canRun then
                canRun = false
                spawn(function()
                    local player = game:GetService("Players").LocalPlayer
                    if not player or not player.Character then
                        canRun = true
                        return
                    end
                    local questTitle = player.PlayerGui.Main.Quest.Container.QuestTitle.Title.Text
                    local questVisible = player.PlayerGui.Main.Quest.Visible
                    local humanoidRoot = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
                    -- Abandona quest se não bate com o nome do mon atual
                    if not string.find(questTitle or "", NameMon or "") then
                        getgenv().StartMagnet = false
                        pcall(function() ReplicatedStorage.Remotes.CommF_:InvokeServer("AbandonQuest") end)
                    end
                    if not questVisible then
                        getgenv().StartMagnet = false
                        CheckQuest()
                        -- Teleporta para NPC (usar topos/tween conforme disponível)
                        if humanoidRoot and CFrameQuest then
                            humanoidRoot.CFrame = CFrameQuest
                        end
                        if humanoidRoot and (humanoidRoot.Position - CFrameQuest.Position).Magnitude <= 20 then
                            pcall(function() ReplicatedStorage.Remotes.CommF_:InvokeServer("StartQuest", NameQuest, LevelQuest) end)
                        end
                    elseif questVisible then
                        CheckQuest()
                        local enemies = workspace.Enemies:GetChildren()
                        for _, v in pairs(enemies) do
                            if v:FindFirstChild("HumanoidRootPart") and v:FindFirstChild("Humanoid") then
                                if v.Humanoid.Health > 0 and v.Name == Mon then
                                    if string.find(game:GetService("Players").LocalPlayer.PlayerGui.Main.Quest.Container.QuestTitle.Title.Text, NameMon) then
                                        repeat
                                            task.wait(0.1)
                                            AutoHaki()
                                            EquipWeapon(getgenv().SelectWeapon)
                                            PosMon = v.HumanoidRootPart.CFrame
                                            -- move para o mob (topos usado no hub; aqui usamos CFrame direto)
                                            if v and v.HumanoidRootPart then
                                                pcall(function()
                                                    game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = v.HumanoidRootPart.CFrame * CFrame.new(0,0,5)
                                                end)
                                            end
                                            v.HumanoidRootPart.CanCollide = false
                                            v.Humanoid.WalkSpeed = 0
                                            v.Head.CanCollide = false
                                            getgenv().StartMagnet = true
                                            if getgenv().AutoClick then
                                                -- emular clique
                                                VirtualUser:CaptureController()
                                                VirtualUser:ClickButton1(Vector2.new(0,0))
                                            end
                                        until not getgenv().AutoFarm or not v.Parent or v.Humanoid.Health <= 0 or not game:GetService("Players").LocalPlayer.PlayerGui.Main.Quest.Visible
                                    else
                                        getgenv().StartMagnet = false
                                        pcall(function() ReplicatedStorage.Remotes.CommF_:InvokeServer("AbandonQuest") end)
                                    end
                                end
                            end
                        end
                    end
                end)
                task.wait(0.5)
                canRun = true
            end
        end
    end
end)

-- Auto Store Fruit (copiado da lista de frutas e lógica de armazenamento). Fonte: Allan Hub. fileciteturn0file5turn0file11
spawn(function()
    while task.wait(0.2) do
        if getgenv().AutoStoreFruit then
            pcall(function()
                local player = game:GetService("Players").LocalPlayer
                local character = player.Character
                local backpack = player.Backpack
                local fruits = {
                    {"Rocket Fruit", "Rocket-Rocket"},
                    {"Spin Fruit", "Spin-Spin"},
                    {"Blade Fruit", "Blade-Blade"},
                    {"Spring Fruit", "Spring-Spring"},
                    {"Bomb Fruit", "Bomb-Bomb"},
                    {"Smoke Fruit", "Smoke-Smoke"},
                    {"Spike Fruit", "Spike-Spike"},
                    {"Flame Fruit", "Flame-Flame"},
                    {"Falcon Fruit", "Falcon-Falcon"},
                    {"Ice Fruit", "Ice-Ice"},
                    {"Sand Fruit", "Sand-Sand"},
                    {"Dark Fruit", "Dark-Dark"},
                    {"Diamond Fruit", "Diamond-Diamond"},
                    {"Light Fruit", "Light-Light"},
                    {"Rubber Fruit", "Rubber-Rubber"},
                    {"Barrier Fruit", "Barrier-Barrier"},
                    {"Ghost Fruit", "Ghost-Ghost"},
                    {"Magma Fruit", "Magma-Magma"},
                    {"Quake Fruit", "Quake-Quake"},
                    {"Buddha Fruit", "Buddha-Buddha"},
                    {"Love Fruit", "Love-Love"},
                    {"Spider Fruit", "Spider-Spider"},
                    {"Sound Fruit", "Sound-Sound"},
                    {"Phoenix Fruit", "Phoenix-Phoenix"},
                    {"Portal Fruit", "Portal-Portal"},
                    {"Rumble Fruit", "Rumble-Rumble"},
                    {"Pain Fruit", "Pain-Pain"},
                    {"Blizzard Fruit", "Blizzard-Blizzard"},
                    {"Gravity Fruit", "Gravity-Gravity"},
                    {"Mammoth Fruit", "Mammoth-Mammoth"},
                    {"T-Rex Fruit", "T-Rex-T-Rex"},
                    {"Dough Fruit", "Dough-Dough"},
                    {"Shadow Fruit", "Shadow-Shadow"},
                    {"Venom Fruit", "Venom-Venom"},
                    {"Gas Fruit", "Gas-Gas"},
                    {"Control Fruit", "Control-Control"},
                    {"Spirit Fruit", "Spirit-Spirit"},
                    {"Leopard Fruit", "Leopard-Leopard"},
                    {"Yeti Fruit", "Yeti-Yeti"},
                    {"Kitsune Fruit", "Kitsune-Kitsune"},
                    {"Dragon Fruit", "Dragon-Dragon"},
                }
                for _, fruit in ipairs(fruits) do
                    local fruitName, serverName = fruit[1], fruit[2]
                    if character:FindFirstChild(fruitName) or backpack:FindFirstChild(fruitName) then
                        pcall(function()
                            ReplicatedStorage.Remotes.CommF_:InvokeServer("StoreFruit", serverName, backpack:FindFirstChild(fruitName))
                        end)
                    end
                end
            end)
        end
    end
end)

-- Auto Collect Fruit (pega frutas do chão) - inspirado no Allan Hub. fileciteturn0file2
spawn(function()
    while task.wait(0.5) do
        if getgenv().AutoCollectFruit then
            local player = game.Players.LocalPlayer
            local char = player.Character or player.CharacterAdded:Wait()
            local hrp = char:FindFirstChild("HumanoidRootPart")
            if hrp then
                for _, v in pairs(workspace:GetChildren()) do
                    if v:IsA("Model") and string.find(v.Name, "Fruit") and v:FindFirstChild("Handle") then
                        pcall(function() hrp.CFrame = v.Handle.CFrame end)
                    end
                    if v:IsA("Tool") and string.find(string.lower(v.Name), "fruit") then
                        pcall(function()
                            if v:FindFirstChild("Handle") then
                                v.Handle.CFrame = hrp.CFrame
                            else
                                v.CFrame = hrp.CFrame
                            end
                        end)
                    end
                end
            end
        end
    end
end)

-- Auto Spin Fruit (gacha) - usa Cousin Buy como no Allan Hub. Fonte: Allan Hub. fileciteturn0file1
spawn(function()
    while task.wait(10) do
        if getgenv().AutoSpinFruit then
            pcall(function()
                ReplicatedStorage.Remotes.CommF_:InvokeServer("Cousin", "Buy")
            end)
        end
    end
end)

print("AllanHubCopy.lua carregado — funções principais copiadas do Allan Hub. Ajuste toggles globais para ativar.")
